---

##
# Installation
##
bacula_version: 11.0.5
bacula_community_registration: changeme! # Registration: https://www.bacula.org/bacula-binary-package-download/
bacula_download_url: "https://www.bacula.org/packages/{{ bacula_community_registration }}/bacula/debs/{{ bacula_version }}"
bacula_database_engine: mysql # postgresql, mysql , sqlite3
bacula_install_console: yes
bacula_install_aligned: no
bacula_install_common: yes
bacula_install_client: yes
bacula_root: /opt/bacula
bacula_owner: bacula
bacula_group: tape
bacula_storage_default: bacula-sd

###
# Director
###
bacula__default__directors:
  Name: "bacula-dir"
  Description: "Some description here"
  DIRAddress: "0.0.0.0"
  DIRport: 9101
  Messages: "{{ bacula_messages_default }}"
  WorkingDirectory: "{{ bacula_root }}"
  PidDirectory: "{{ bacula_root + '/working/' }}"
  Heartbeat_Interval: 60
  Maximum_Concurrent_Jobs: 50
  QueryFile: "{{ bacula_root + '/scripts/query.sql' }}"

bacula_directors: |
  {{ bacula__default__directors | combine(
    bacula_custom_directors | default({})
  )}}

###
# Console
###
bacula__default__consoles:
  - Name: default
    Password: changeme!

bacula_consoles: |
  {{ bacula__default__consoles | combine(
    bacula_custom_consoles | default({})
  )}}

###
# JobDefs
###
bacula__default__jobdefs:
  - Name: DefaultWindowsJob
    Type: Backup
    Level: Incremental
    Storage: "{{ bacula_storage_default }}"
    FileSet: "default-windows-fs"
    Max_Wait_Time: "{{ bacula_jobdef_maximum_wait_time | default(3600) }}"
    Prefer_Mounted_Volumes: No
    Maximum_Concurrent_Jobs: "{{ bacula_jobdef_maximum_concurrent_jobs | default(8) }}"
    Messages: "{{ bacula_messages_default }}"
    SpoolAttributes: Yes
    Prune_Files: Yes
    Prune_Jobs: yes
    Prune_Volumes: Yes
    Priority: 10
  - Name: DefaultLinuxJob
    Type: Backup
    Level: Incremental
    Storage: "{{ bacula_storage_default }}"
    FileSet: "default-linux-fs"
    Max_Wait_Time: "{{ bacula_jobdef_maximum_wait_time | default(3600) }}"
    Prefer_Mounted_Volumes: No
    Maximum_Concurrent_Jobs: "{{ bacula_jobdef_maximum_concurrent_jobs | default(8) }}"
    Messages: "{{ bacula_messages_default }}"
    SpoolAttributes: Yes
    Prune_Files: Yes
    Prune_Jobs: yes
    Prune_Volumes: Yes
    Priority: 10

bacula_jobdefs: |
  {{ bacula__default__jobdefs | combine(
    bacula_jobdefs_custom | default({})
  )}}

###
# Messages
###
bacula_messages_default: bacula-msg
bacula_messages_from: "root@{{ ansible_fqdn }}"
bacula_messages_rcpt: "root@{{ ansible_fqdn }}"
bacula_message_mail_subject: "Bacula: %t %e of %c %l"
bacula_message_operator_subject: "Bacula: Intervention needed for %j"
bacula_messages_relay: 127.0.0.1
bacula__default__messages:
  - Name: bacula-msg
    MailCommand: "/usr/sbin/bsmtp -h {{ bacula_messages_relay }} -f {{ bacula_messages_from }} -s '{{ bacula_message_mail_subject }}' %r"
    Operatorcommand: "/usr/sbin/bsmtp -h {{ bacula_messages_relay }} -f {{ bacula_messages_from }} -s '{{ bacula_message_operator_subject }}' %r"
    Mail: "{{ bacula_messages_rcpt }} = error, warning, !skipped, !terminate, !restored"
    Append:
      - "'/var/log/bacula/info.log' = info, terminate"
      - "'/var/log/bacula/error_warning.log' = error, warning, !terminate, notsaved"
      - "'/var/log/bacula/all.log' = all"
    Operator: "{{ bacula_messages_rcpt }} = mount"
    Console: "error, warning, !terminate"
    Syslog: all


bacula_messages: |
  {{ bacula__default__messages | combine(
    bacula_messages_custom | default({})
  )}}


###
# Schedules
###
bacula__default__schedules:
  - name: DailyFI-Weekly
    run:
      - "Level=Full sun at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"
      - "Level=Incremental mon-sat at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"
  - name: DailyFDI-Biweekly
    run:
      - "Level=Full 1st,3rd sun at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"
      - "Level=Differential 2nd,4th,5th sun at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"
      - "Level=Incremental mon-sat at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"
  - name: DailyFDI-Monthly
    run:
      - "Level=Full 1st sun at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"
      - "Level=Differential 2nd,3rd,4th,5th sun at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"
      - "Level=Incremental mon-sat at {% if hour|d() %} {{ hour }} {% else %} {{ [1,2,3,4]|random }}:00 {% endif %}"

bacula_schedules: |
  {{ bacula__default__schedules | combine(
    bacula_schedules_custom | default({})
  )}}

###
# FileSets
###
bacula__default__filesets:
  - Name: default-linux-fs
    Include:
      Options:
        signature: MD5
        compression: GZIP6
      File:
        - /etc
        - /home
        - /root
        - /var/backups
    Exclude:
      File:
        - /proc
        - /tmp
        - /.journal
        - /.fsck

bacula_filesets: |
  {{ bacula__default__filesets | combine(
    bacula_filesets_custom | default({})
  )}}