---

###
# Schedules
###

schedule_DailyVI_Weekly: |
  {% set res = [ ] %}
  {% set runs = [ "Level=VirtualFull sun at ", "Level=Incremental mon-sat at "] %}
  {% for h in range(24) %}
  {% for m in ['00','30'] %}
  {%
    if res.append(
      {
        'name': 'DailyVI-Weekly-'+'%02d' | format(h)|string+m,
        'run': runs | map('regex_replace', '^(.*) at $', '\\1 at '+h|string+':'+m) | list
      }
    )
  %}
  {% endif %}
  {% endfor %}
  {% endfor %}
  {{ res }}

schedule_DailyVDI_Biweekly: |
  {% set res = [ ] %}
  {% set runs = [ "Level=VirtualFull 1st,3rd sun at ", "Level=Differential 2nd,4th,5th sun at ", "Level=Incremental mon-sat at "] %}
  {% for h in range(24) %}
  {% for m in ['00','30'] %}
  {%
    if res.append(
      {
        'name': 'DailyVDI-Biweekly-'+'%02d' | format(h)|string+m,
        'run': runs | map('regex_replace', '^(.*) at $', '\\1 at '+h|string+':'+m) | list
      }
    )
  %}
  {% endif %}
  {% endfor %}
  {% endfor %}
  {{ res }}

schedule_DailyVDI_Monthly: |
  {% set res = [ ] %}
  {% set runs = [ "Level=VirtualFull 1st sun at ", "Level=Differential 2nd,3rd,4th,5th sun at ", "Level=Incremental mon-sat at "] %}
  {% for h in range(24) %}
  {% for m in ['00','30'] %}
  {%
    if res.append(
      {
        'name': 'DailyVDI-Monthly-'+'%02d' | format(h)|string+m,
        'run': runs | map('regex_replace', '^(.*) at $', '\\1 at '+h|string+':'+m) | list
      }
    )
  %}
  {% endif %}
  {% endfor %}
  {% endfor %}
  {{ res }}

bacula__default__schedules: "{{ schedule_DailyVI_Weekly + schedule_DailyVDI_Biweekly + schedule_DailyVDI_Monthly }}"

bacula_schedules: |
  {{
    bacula__default__schedules +
    bacula_schedules_custom | default([])
  }}
