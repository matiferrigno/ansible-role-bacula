###############################
## Auto-generated by:        ##
##         Ansible           ##
## Don't do changes by hand  ##
## Role: matiferrigno.bacula ##
###############################

{% if enabled | default(true) | bool %}

FileSet {
    Name = {{ policy }}-{{ schedule }}-fs
    Include {
        Options {
          signature = MD5
          compression = GZIP6
        }
    {% for f in files_include | default([]) %}
      File = {{ f }}
    {% endfor %}
    }
    Exclude {
      {% for f in files_exclude | default([]) %}
      File = {{ f }}
      {% endfor %}
      @/etc/bacula/fileset.d/exclude-default.conf
    }
}

JobDefs {
    Name = {{ client }}BackupDef
    Type = Backup
    Storage = stg-{{ storage }}
    Level = Incremental
    Client = {{ client }}-fd
    Pool = {{ client }}-Inc-Pool
    Full Backup Pool = {{ client }}-Full-Pool
    Differential Backup Pool = {{ client }}-Diff-Pool
    Incremental Backup Pool = {{ client }}-Inc-Pool

    Max Wait Time = 3600
    Prefer Mounted Volumes = no
    Maximum Concurrent Jobs = 8
    Prune Files = yes
    Prune Jobs = yes
    Prune Volumes = yes
    Priority = 10

    @/etc/bacula/conf.d/telegram.conf
}

Job {
    Name = Backup_{{ client }}
    JobDefs ={{ client }}BackupDef
    FileSet = {{ client }}-{{ policy }}-fs
    Storage = stg-{{ storage }}
    Schedule = {{ client+"-"+policy+"-"+schedule | default(policy+"-"+bacula_job_schedule_default) }}
    {% if run_before|d() %}
    Client Run before job = {{ run_before }}
    {% endif %}
    {% if run_after|d() %}
    Client Run after job = {{ run_after }}
    {% endif %}
}

Job{
    Name = Restore_{{ client }}
    Type = restore
    Client = {{ client }}-fd
    File Set = {{ client }}-{{ policy }}-fs
    Messages = {{ bacula_messages_name }}
    Pool = {{ client }}-Inc-Pool
    Storage = {{ storage }}
    Where = /tmp
}

{% endif %}